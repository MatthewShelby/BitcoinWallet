<!DOCTYPE html>
<!-- import seedrandom from 'seedrandom'; -->

<html>

<head>
	<script src="buidl.js"></script>
	<!-- <script src="//cdnjs.cloudflare.com/ajax/libs/seedrandom/3.0.5/seedrandom.min.js">
	</script> -->
	<!-- <script src="node_modules/random-words/index.js" type="script"></script> -->

</head>
<style>
	.box {
		border: 1px black solid;
		padding: 10px;
	}

	.step {
		background-color: #cccccc;
		padding: 10px;
	}
</style>

<body>
	<h1>Wallet app</h1>
	<hr>
	Select Bitcoin network
	<select id="network">
		<option value="mainnet">Mainnet</option>
		<option value="testnet">Testnet</option>
	</select>
	<br>
	<br>
	<br>
	<div>
		<div class="box">
			<div>
				<h2>Generate new wallet</h2>
				<div class="step">
					<h4>Step 1- Generate seed phrase</h4>
					<button id="gws" onclick="gw()">Generate words</button>
					<p>Please copy the phrase and keep it safe.</p>
					<br>
					<label for="">Seed phrase: </label>
					<br>
					<textarea name="" id="wrd" cols="60" rows="5" style="resize: none;" readonly></textarea>
					<br>

				</div>
			</div>
			<br>
			<div>
				<div class="step">

					<h4>Step 2- Generate Keys </h4>
					<button onclick="gen()">Generate Keys</button>

					<p>Please copy keys and keep them safe. Never shaare the private key. its ok to publish
						your address.</p>

					<label for="">WIF:</label>
					<p id="wif0"></p>
					<br>
					<label for="">Private Key:</label>
					<p id="pry"></p>
					<br>
					<label for="">Public Key:</label>
					<p id="pub"></p>
					<br>
					<label for="">Address:</label>
					<p id="adr"></p>
					<br>
					<label for="">Address:</label>
					<p id="adr1"></p>
					<br>
				</div>
			</div>
		</div>
		<br>

		<div class="box">
			<h2>Import existing wallet</h2>
			<div class="step">
				<h4 for="">Insert Recovery Seed phrase: </h4>
				<br>
				<textarea name="" id="impwrd" cols="60" rows="5" style="resize: none;"></textarea>
				<br>
				<button id="" onclick="import2()">Import</button>
				<br>
				<p>Please copy keys and keep them safe. Never shaare the private key. its ok to publish
					your address.</p>

				<label for="">WFI:</label>
				<p id="wfiw"></p>
				<br>
				<label for="">Private Key:</label>
				<p id="pry2"></p>
				<br>
				<label for="">Public Key:</label>
				<p id="pub2"></p>
				<br>
				<label for="">Address:</label>
				<p id="adr2"></p>
				<br>
				<label for="">Address:</label>
				<p id="adr21"></p>
				<br>
			</div>
		</div>
		<script src="./myword.js"></script>
		<script src="https://code.jquery.com/jquery-3.6.4.js"
			integrity="sha256-a9jBBRygX1Bh5lt8GZjXDzyOB+bWve9EiO7tROUtj/E=" crossorigin="anonymous"></script>
		<script>
			// var randomWords;
			var mywords;
			var hasWords = false;
			function gw() {
				if (hasWords) {
					mywords = ''
					document.getElementById('wrd').value = '';
				}
				//var words = words();
				mywords = getWords(12);
				document.getElementById('wrd').value += (mywords);
				hasWords = true;

			}

			function gen() {
				if (hasWords) {
					var b = buidl.mnemonic2SeedHex(mywords)
					console.info(b)


					var c0 = buidl.seedToXprv(b.seedHex, 84, 0);
					console.info(c0)

					var c = buidl.seedToXpub(b.seedHex, 84, 0);
					console.info(c)

					var d = buidl.fromXpub(c, 0, 0);
					console.info(d)
					var d1 = buidl.fromXpub(c, 0, 1);
					console.info(d1)
					var wif = buidl.xprvToWIF(c0, 0, 0);
					console.info(wif)
					document.getElementById('wif0').innerHTML = b.seedHex;
					document.getElementById('pry').innerHTML = C0;
					document.getElementById('pub').innerHTML = c;
					document.getElementById('adr').innerHTML = d.addr;
					document.getElementById('adr1').innerHTML = d1.addr;
				} else {
					window.alert('Generate words please')
				}


			}

			function gett() {
				const settings = {
					// "async": true,
					crossDomain: true,
					url: "https://block.io/api/v2/get_address_balance/?api_key=5b7a-fef8-f628-4ad4&addresses=bc1q9pwknsmr5jcuap4hm533ns0dztfdvuje0gs09x",
					method: "GET",
					headers: {
						"Access-Control-Allow-Headers": "X-Requested-With",
						"X-Requested-With": "XMLHttpRequest"
					},

				};

				$.ajax(settings).done(function (response) {
					console.log(response);
				});
			}

			function gt() {
				var td = "0100000001933d29b6e86517e9688013a8ded20c56e67254100b64adbb41f538351ddf82bc010000006a47304402204957662839960287f93fdc7aaedaa069cd2e8916aad3eb518ed0bbeff39655b602206e80438ae113575d7b37ca1dc89c8e7e50d3125b190386390e443c3380e480ca012103daa0209f20844a100b65906ad6d2244e8b4fab3447fed5e85fe8280713b29f5fffffffff01f82a0000000000001976a9141ebdc7adf4aedd58b6ac65fa208c07a6483ae18d88ac00000000"

				fetch('https://btc.getblock.io/mainnet/', {
					method: 'POST',
					headers: {
						'x-api-key': '125e8d72-ad78-4f7b-bc4f-5004e32772da',
						'Content-Type': 'application/json'
					},
					// body: '{"jsonrpc": "2.0",\n"method": "sendrawtransaction",\n"params": ["hexstring", null],\n"id": "getblock.io"}',
					body: JSON.stringify({
						'jsonrpc': '2.0',
						'method': 'sendrawtransaction',
						'params': [
							'01000000000101933d29b6e86517e9688013a8ded20c56e67254100b64adbb41f538351ddf82bc0300000000ffffffff0100000000000000001976a9141ebdc7adf4aedd58b6ac65fa208c07a6483ae18d88ac02473044022026054661ce33cd509a37619743fbf2245d0536a5a7383e9982c05575d0bc6c1002202ddff4792435af422404f03b2a292546658dc9bfcb207cd407d1979999cac4c5012103daa0209f20844a100b65906ad6d2244e8b4fab3447fed5e85fe8280713b29f5f00000000',
							null
						],
						'id': 'getblock.io'
					})
				});
				/*
								const settings = {
									// "async": true,
									// "crossDomain": true,
									"url": "https://btc.getblock.io/mainnet/",
									"method": "POST",
									"headers": {
										"x-api-key": "125e8d72-ad78-4f7b-bc4f-5004e32772da",
										"Content-Type": "application/json"
									},
									"data": "{\"jsonrpc\": \"2.0\",\n\"method\": \"sendrawtransaction\",\n\"params\": [\"0100000001933d29b6e86517e9688013a8ded20c56e67254100b64adbb41f538351ddf82bc010000006a47304402200fdd9af60227d5316db48af1ce49ebd3e9c650e9c759a4b1e104dd8c5aa9caf002204f025d25610d465ec1b33d6340f5f332d697ba72f31f72827298591a31e4261c012103daa0209f20844a100b65906ad6d2244e8b4fab3447fed5e85fe8280713b29f5fffffffff0170170000000000001976a9141ebdc7adf4aedd58b6ac65fa208c07a6483ae18d88ac00000000\",null],\n\"id\" : \"getblock.io\"}"
								};
				
								$.ajax(settings).done(function (response) {
									console.log(response);
								});*/
			}

			function nn() {
				const settings = {
					"async": true,
					"crossDomain": true,
					"url": "https://btc.getblock.io/mainnet/",
					"method": "POST",
					"headers": {
						"x-api-key": "125e8d72-ad78-4f7b-bc4f-5004e32772da",
						"Content-Type": "application/json"
					},
					"processData": false,
					"data": "{\"jsonrpc\": \"2.0\",\n\"method\": \"gettxout\",\n\"params\": [\"bc82df1d3538f541bbad640b105472e6560cd2dea8138068e91765e8b6293d93\", 3, null],\n\"id\": \"getblock.io\"}"
				};

				$.ajax(settings).done(function (response) {
					console.log(response);
				});
			}
			function import2() {
				//impwrd
				mywords = document.getElementById('impwrd').value
				var b = buidl.mnemonic2SeedHex(mywords)

				console.info(b)

				var c0 = buidl.seedToXprv(b.seedHex, 84, 0);
				console.info(c0)
				var c = buidl.seedToXpub(b.seedHex, 84, 0);
				console.info(c)

				var d = buidl.fromXpub(c, 0, 0);
				console.info(d)
				var d1 = buidl.fromXpub(c, 0, 1);
				console.info(d1)
				var wif = buidl.xprvToWIF(c0, 0, 0);
				console.info(wif)

				document.getElementById('wfiw').innerHTML = wif;
				document.getElementById('pry2').innerHTML = c0;
				document.getElementById('pub2').innerHTML = c;
				document.getElementById('adr2').innerHTML = d.addr;
				document.getElementById('adr21').innerHTML = d1.addr;



			}
			// function gen() {
			// 	let newPair = buidl.createP2PKH();
			// 	let address = newPair.addr;
			// 	let privateKey = newPair.pk;
			// 	document.getElementById('adr').innerHTML = address;
			// 	document.getElementById('pry').innerHTML = privateKey;
			// 	console.info(newPair);
			// }
            //console.log(address, privateKey);

		//
			//c51aeccab60f3cd7942448917cadaef4209db1e7fecf3d0f1e4655f4aaadb8014ac647bc45e49cd24b75e2fc4264f942b51bd8c710275c08dffa4145e59b45f0
			//9faba3d77006ac0bebc6442f6527fc6e74267e1d7b5cb6874e560897b9996867
		</script>
	</div>

	<table width="100%">
		<tr>
			<td width="65%">
				<h3>INPUT</h3>
				<table width="100%">
					<tr>
						<td width="10">Type</td>
						<td width="60%">Transaction Hash/ID</td>
						<td width="10%">N Out</td>
						<td width="20%">Input Value</td>
					</tr>
					<tr>
						<td><input type="text" id="typei" size="10" onkeyup="return checkWitness();"></td>
						<td><input type="text" id="txidi" size="65"></td>
						<td><input type="text" id="outni" size="10"></td>
						<td><input type="text" id="inputvalue" size="20"></td>
					</tr>
				</table>
			</td>

			<td>
				<h3>OUTPUT(S)</h3>
				<table width="100%">
					<tr>
						<td width="70%">Address</td>
						<td width="30%">Value</td>

					</tr>
					<tr>
						<td><input type="text" id="outputi" size="30"></td>
						<td><input type="text" id="amounti"></td>
					</tr>
					<tr>
						<td><input type="text" id="changeout" size="30"></td>
						<td><input type="text" id="changeamt"></td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<p>WIF Private Key of Input</p>
	<input type="text" id="wifi" size="45">
	<br>
	<button onclick="return createTx();">Create Transaction</button>
	<br>
	<textarea id="signedtxoutput" readonly cols="45" rows="3"></textarea>

	<script>
		function createTx() {
			let network = document.getElementById("network").value;
			let istestnet = network === "testnet" ? "testnet" : "";
			let typei = document.getElementById("typei").value.trim();
			let txidi = document.getElementById("txidi").value.trim();
			let outni = parseInt(document.getElementById("outni").value.trim());
			let inputvalue = parseInt(document.getElementById("inputvalue").value.trim());
			inputvalue ? inputvalue : null;
			let outputi = document.getElementById("outputi").value.trim();
			let amounti = parseInt(document.getElementById("amounti").value.trim());
			let changeout = document.getElementById("changeout").value.trim();
			changeout ? changeout : null;
			let changeamt = parseInt(document.getElementById("changeamt").value.trim());
			changeamt ? changeamt : null;
			let wifi = document.getElementById("wifi").value.trim();
			let rawtx = buidl.createTransaction(typei, txidi, outni, outputi, amounti, wifi, changeout, changeamt, inputvalue, istestnet);
			document.getElementById("signedtxoutput").innerHTML = rawtx.signedtx;
		}
		function checkWitness() {
			let checkType = document.getElementById("typei").value.trim();
			if (checkType === "1") {
				document.getElementById("inputvalue").disabled = true;
			} else {
				document.getElementById("inputvalue").disabled = false;
			}
		}
	</script>
</body>

</html>